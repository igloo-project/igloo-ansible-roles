---
# mandatory argument
_logrotate_application_name: "{{ logrotate_application_name }}"
_logrotate_user: "{{ logrotate_user }}"
_logrotate_group: "{{ logrotate_group }}"


# others
# list : ['httpd', 'tomcat'] by default
_logrotate_items: "{{ logrotate_items | default(_logrotate_default_items) }}"
# list of either _logrotate_entries key or dict(pattern=,config=,template_vars=,)
_logrotate_default_items:
  - httpd
  - tomcat

_logrotate_default_template_vars:
  postrotate: ''
_logrotate_web_log_path: /data/log/web
_logrotate_tomcat_log_path: >-
  /data/services/web/{{ _logrotate_application_name }}/tomcat/logs

_logrotate_default_config: |
  {
      daily
      missingok
      rotate 30
      compress
      notifempty
      create 644 {{ template_vars.user | default('root') }} {{ template_vars.group | default('adm') }}
      dateext
      sharedscripts
      {{ template_vars.postrotate if template_vars.postrotate else '' }}
  }

_logrotate_entries:
  httpd:
    filename: "{{ _logrotate_application_name }}-httpd"
    pattern: >-
      {{ _logrotate_web_log_path }}/*/*.log
      {{ _logrotate_web_log_path }}/*/*_log
    config: "{{ _logrotate_default_config }}"
    template_vars:
      postrotate: |-
        postrotate
          /bin/systemctl httpd reload > /dev/null 2>/dev/null || true
        endscript
      user: root
      group: adm
  tomcat:
    filename: "{{ _logrotate_application_name }}-tomcat"
    pattern: >-
      {{ _logrotate_tomcat_log_path }}/*.log
      {{ _logrotate_tomcat_log_path }}/*.out
    config: "{{ _logrotate_default_config }}"
    template_vars:
      user: "{{ logrotate_user }}"
      group: "{{ logrotate_group }}"
